var KR = this.KR || {};

KR.KulturminneAPI = function (apiName) {
    'use strict';

    var mockData = {
    "data": [
        {
            "href": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.tif.info",
            "archiveHREF": "/fotoweb/archives/5001-Alle%20kulturminnebilder/",
            "linkstance": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.tif.info",
            "created": "2017-09-12T10:53:07.181000Z",
            "createdBy": "system",
            "modified": "2016-08-17T09:26:57Z",
            "modifiedBy": "system",
            "filename": "T001_09_0453.tif",
            "filesize": 72700928,
            "uniqueid": "",
            "permissions": [
                "View",
                "Preview",
                "Download"
            ],
            "pincount": 0,
            "previewcount": 12,
            "downloadcount": 0,
            "workflowcount": 0,
            "metadataeditcount": 0,
            "revisioncount": 0,
            "doctype": "image",
            "previews": [
                {
                    "size": 800,
                    "width": 800,
                    "height": 535,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m800.tif.pv.xSYZCihZvBrk-TrNYHD4J8_YNkVLCP2y7HWDwV5rQ1eI.jpg",
                    "square": false
                },
                {
                    "size": 1200,
                    "width": 1200,
                    "height": 802,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m1200.tif.pv.xJKVrVxGC_-Mxi40dQZF5_qVDfSbEtMO0jiXz7ep69GM.jpg",
                    "square": false
                },
                {
                    "size": 1600,
                    "width": 1600,
                    "height": 1069,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m1600.tif.pv.xVz_e3DzAp_gwkTMLezYpGnKK1002cH4zItn8bysnut8.jpg",
                    "square": false
                },
                {
                    "size": 2400,
                    "width": 2400,
                    "height": 1603,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m2400.tif.pv.xZEt2T8plHPx_GKtcMis-hpd8pQQuN-ziKO-I2NSFRyE.jpg",
                    "square": false
                },
                {
                    "size": 200,
                    "width": 200,
                    "height": 135,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m200.tif.pv.xhSD__NxPi_GSh6-Zza-Q0WYKshJKH44MMxPUeyVbsX4.jpg",
                    "square": false
                },
                {
                    "size": 300,
                    "width": 300,
                    "height": 201,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m300.tif.pv.xYN6z9fSRHk2k3Oe7GF_HXvVcb5lMddZAtVEshnywFYo.jpg",
                    "square": false
                },
                {
                    "size": 400,
                    "width": 400,
                    "height": 268,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m400.tif.pv.xOfgEeTF5a0_i09q8WrEobeDX0NwBH4uuI2QrqJJueuY.jpg",
                    "square": false
                },
                {
                    "size": 600,
                    "width": 600,
                    "height": 402,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m600.tif.pv.xAsQHNa05IE8hDzXTxbxvMlk1nmJ6mglkZs8PWRPe_ow.jpg",
                    "square": false
                },
                {
                    "size": 100,
                    "width": 100,
                    "height": 100,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m100.q.tif.pv.xlwD83kSIfe7MEAd37ADgZGNO9K8mQ_Nogo_fMR6fPM4.jpg",
                    "square": true
                },
                {
                    "size": 200,
                    "width": 200,
                    "height": 200,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m200.q.tif.pv.xLz6yF3PZs9R5yg13RQV07lMUtnZA7NMtj02BfesN3Yc.jpg",
                    "square": true
                },
                {
                    "size": 200,
                    "width": 200,
                    "height": 200,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m200.q.tif.pv.xLz6yF3PZs9R5yg13RQV07lMUtnZA7NMtj02BfesN3Yc.jpg",
                    "square": true
                },
                {
                    "size": 400,
                    "width": 400,
                    "height": 400,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m400.q.tif.pv.xdZPmwrJLTZRITwGLbL_Qnhdm8UWbxQPGl_yXf0D_gUc.jpg",
                    "square": true
                }
            ],
            "quickRenditions": [
                {
                    "size": 200,
                    "width": 200,
                    "height": 135,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m200.tif.pv.xhSD__NxPi_GSh6-Zza-Q0WYKshJKH44MMxPUeyVbsX4.jpg",
                    "square": false,
                    "name": "Web (200px)"
                },
                {
                    "size": 800,
                    "width": 800,
                    "height": 535,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m800.tif.pv.xSYZCihZvBrk-TrNYHD4J8_YNkVLCP2y7HWDwV5rQ1eI.jpg",
                    "square": false,
                    "name": "Presentation (800px)"
                },
                {
                    "size": 2048,
                    "width": 2048,
                    "height": 1368,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.t57b41fd7.m2048.tif.pv.xuGLIjs_xJSRWkjuVnOHXGx8tA9z0ypLSZ7lRuNhCZoE.jpg",
                    "square": false,
                    "name": "Editor (2048px)"
                }
            ],
            "metadataEditor": {
                "name": "RA Kulturminnebilder",
                "href": "/fotoweb/editors/4f52e7f5-4d1a-4978-a761-1966acdae434"
            },
            "renditions": [
                {
                    "display_name": "Originalfil",
                    "description": "Originalfil",
                    "width": 6016,
                    "height": 4016,
                    "href": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.tif.info/__renditions/ORIGINAL",
                    "default": true,
                    "original": true
                },
                {
                    "display_name": "Liten JPEG",
                    "description": "",
                    "width": 0,
                    "height": 0,
                    "href": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.tif.info/__renditions/Liten%20JPEG",
                    "default": false,
                    "original": false
                },
                {
                    "display_name": "Stor JPEG",
                    "description": "",
                    "width": 0,
                    "height": 0,
                    "href": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0453.tif.info/__renditions/Stor%20JPEG",
                    "default": false,
                    "original": false
                }
            ],
            "attributes": {
                "imageattributes": {
                    "pixelwidth": 6016,
                    "pixelheight": 4016,
                    "resolution": 300,
                    "flipmirror": 0,
                    "rotation": 0,
                    "colorspace": "rgb"
                },
                "photoAttributes": {
                    "cameraModel": "NIKON D750",
                    "exposure": {
                        "n": 1,
                        "d": 320
                    },
                    "fNumber": 8,
                    "focalLength": 36,
                    "isoSpeed": 100,
                    "flash": {
                        "fired": false
                    }
                }
            },
            "metadata": {
                "5": {
                    "value": "Akersryggen, Egebergløkka, Telthusbakken"
                },
                "25": {
                    "value": [
                        "BYER"
                    ]
                },
                "55": {
                    "value": "2016-03-16"
                },
                "80": {
                    "value": [
                        "Buskoven, Lene"
                    ]
                },
                "90": {
                    "value": "Oslo"
                },
                "95": {
                    "value": "Oslo"
                },
                "101": {
                    "value": "Norway"
                },
                "115": {
                    "value": "Riksantikvaren"
                },
                "116": {
                    "value": "Lene Buskoven"
                },
                "200": {
                    "value": "700 Digitale bilder"
                },
                "208": {
                    "value": "URN:NBN:no-RAKV_arkiv_56FD768F7A0545A3 8BD4BFD48C4DBC83"
                },
                "212": {
                    "value": "K124\n166922"
                },
                "315": {
                    "value": "Navngivelse (by): Dette verket er lisensiert under en Creative Commons Navngivelse 4.0 Internasjonal lisens"
                },
                "320": {
                    "value": "0"
                },
                "741": {
                    "value": "http://creativecommons.org/licenses/by/4.0/deed.no"
                }
            },
            "thumbnailFields": {
                "label": {
                    "value": "Akersryggen, Egebergløkka, Telthusbakken"
                },
                "firstLine": {
                    "value": "K124\n166922"
                },
                "secondLine": {
                    "value": "Oslo"
                },
                "additionalFields": [
                    {
                        "value": "Oslo",
                        "views": [
                            "desktop",
                            "widgets",
                            "web",
                            "pro"
                        ]
                    },
                    {
                        "value": [
                            "Buskoven, Lene"
                        ],
                        "views": [
                            "desktop",
                            "widgets",
                            "web",
                            "pro"
                        ]
                    },
                    {
                        "value": "Navngivelse (by): Dette verket er lisensiert under en Creative Commons Navngivelse 4.0 Internasjonal lisens",
                        "views": [
                            "desktop",
                            "widgets",
                            "web",
                            "pro"
                        ]
                    }
                ]
            },
            "builtinFields": [
                {
                    "field": "title",
                    "required": false,
                    "value": "Akersryggen, Egebergløkka, Telthusbakken"
                },
                {
                    "field": "description",
                    "required": false,
                    "value": ""
                },
                {
                    "field": "tags",
                    "required": false,
                    "value": [
                        "BYER"
                    ]
                },
                {
                    "field": "status",
                    "required": false,
                    "value": ""
                },
                {
                    "field": "notes",
                    "required": false,
                    "value": ""
                }
            ],
            "props": {
                "owner": null,
                "shares": {
                    "enabled": false
                },
                "comments": {
                    "enabled": false
                },
                "facebookComments": null,
                "annotations": {
                    "enabled": false
                },
                "tags": []
            }
        },
        {
            "href": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.tif.info",
            "archiveHREF": "/fotoweb/archives/5001-Alle%20kulturminnebilder/",
            "linkstance": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.tif.info",
            "created": "2017-09-12T10:53:07.167000Z",
            "createdBy": "system",
            "modified": "2016-08-17T09:26:57Z",
            "modifiedBy": "system",
            "filename": "T001_09_0488.tif",
            "filesize": 72714240,
            "uniqueid": "",
            "permissions": [
                "View",
                "Preview",
                "Download"
            ],
            "pincount": 0,
            "previewcount": 12,
            "downloadcount": 0,
            "workflowcount": 0,
            "metadataeditcount": 0,
            "revisioncount": 0,
            "doctype": "image",
            "previews": [
                {
                    "size": 800,
                    "width": 800,
                    "height": 535,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m800.tif.pv.xyZ4KK7SHfajQNzT0qeu0Qxw-WcW1kMtapvW8OiI6Bfk.jpg",
                    "square": false
                },
                {
                    "size": 1200,
                    "width": 1200,
                    "height": 802,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m1200.tif.pv.xzM_QvXr08XfMJ869rahTfc7HrhvaprZIYWlc8brNn5c.jpg",
                    "square": false
                },
                {
                    "size": 1600,
                    "width": 1600,
                    "height": 1069,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m1600.tif.pv.xs95YQDgf9kQCI7iK_SjZtReMnNRiV1hIBqOgjmbjojs.jpg",
                    "square": false
                },
                {
                    "size": 2400,
                    "width": 2400,
                    "height": 1603,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m2400.tif.pv.xrZyZcQ9s_1BnItvTlFvEq30UIfc0kG48nFG36PRqsak.jpg",
                    "square": false
                },
                {
                    "size": 200,
                    "width": 200,
                    "height": 135,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m200.tif.pv.xs1YFuYtZpH0yMN1WurZ3WE-Vk2S4qoyr0cwlAr3cKCs.jpg",
                    "square": false
                },
                {
                    "size": 300,
                    "width": 300,
                    "height": 201,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m300.tif.pv.xX4ZvxIaahM0A0b0ocVisvhT6RF1KCNUYsw9MSKbDWX8.jpg",
                    "square": false
                },
                {
                    "size": 400,
                    "width": 400,
                    "height": 268,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m400.tif.pv.xDBx0jdZf-p_lXIHAiTPe9gqpcZXuc0x0OZ7-pdyJpIk.jpg",
                    "square": false
                },
                {
                    "size": 600,
                    "width": 600,
                    "height": 402,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m600.tif.pv.xgwtZbPwMY5ZfTNH-hwtuxi-Ohq8jHr9yg7vk1bdRsnU.jpg",
                    "square": false
                },
                {
                    "size": 100,
                    "width": 100,
                    "height": 100,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m100.q.tif.pv.xBjbAjMfwueHezxDUjd9kfgfmMSQZsBDWT4vUjoxszNQ.jpg",
                    "square": true
                },
                {
                    "size": 200,
                    "width": 200,
                    "height": 200,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m200.q.tif.pv.xnLafAzcCHLeB9DhECzphqKEqptyth5KSV-4yQqhY_b8.jpg",
                    "square": true
                },
                {
                    "size": 200,
                    "width": 200,
                    "height": 200,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m200.q.tif.pv.xnLafAzcCHLeB9DhECzphqKEqptyth5KSV-4yQqhY_b8.jpg",
                    "square": true
                },
                {
                    "size": 400,
                    "width": 400,
                    "height": 400,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m400.q.tif.pv.xsg-bgEv7xnA-F4n6oIU__Fgfx0XWZz8dv2iFpGrJup8.jpg",
                    "square": true
                }
            ],
            "quickRenditions": [
                {
                    "size": 200,
                    "width": 200,
                    "height": 135,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m200.tif.pv.xs1YFuYtZpH0yMN1WurZ3WE-Vk2S4qoyr0cwlAr3cKCs.jpg",
                    "square": false,
                    "name": "Web (200px)"
                },
                {
                    "size": 800,
                    "width": 800,
                    "height": 535,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m800.tif.pv.xyZ4KK7SHfajQNzT0qeu0Qxw-WcW1kMtapvW8OiI6Bfk.jpg",
                    "square": false,
                    "name": "Presentation (800px)"
                },
                {
                    "size": 2048,
                    "width": 2048,
                    "height": 1368,
                    "href": "/fotoweb/cache/5001/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.t57b41fd7.m2048.tif.pv.xxifY6MrpasfLVU9KIHba64DTe2TDHfy9zSuJaIUlURk.jpg",
                    "square": false,
                    "name": "Editor (2048px)"
                }
            ],
            "metadataEditor": {
                "name": "RA Kulturminnebilder",
                "href": "/fotoweb/editors/4f52e7f5-4d1a-4978-a761-1966acdae434"
            },
            "renditions": [
                {
                    "display_name": "Originalfil",
                    "description": "Originalfil",
                    "width": 6016,
                    "height": 4016,
                    "href": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.tif.info/__renditions/ORIGINAL",
                    "default": true,
                    "original": true
                },
                {
                    "display_name": "Liten JPEG",
                    "description": "",
                    "width": 0,
                    "height": 0,
                    "href": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.tif.info/__renditions/Liten%20JPEG",
                    "default": false,
                    "original": false
                },
                {
                    "display_name": "Stor JPEG",
                    "description": "",
                    "width": 0,
                    "height": 0,
                    "href": "/fotoweb/archives/5001-Alle%20kulturminnebilder/RA1_INDEKS/RA1/Topnummer/T001_09/T001_09_0488.tif.info/__renditions/Stor%20JPEG",
                    "default": false,
                    "original": false
                }
            ],
            "attributes": {
                "imageattributes": {
                    "pixelwidth": 6016,
                    "pixelheight": 4016,
                    "resolution": 300,
                    "flipmirror": 0,
                    "rotation": 0,
                    "colorspace": "rgb"
                },
                "photoAttributes": {
                    "cameraModel": "NIKON D750",
                    "exposure": {
                        "n": 1,
                        "d": 200
                    },
                    "fNumber": 8,
                    "focalLength": 36,
                    "isoSpeed": 100,
                    "flash": {
                        "fired": false
                    }
                }
            },
            "metadata": {
                "5": {
                    "value": "Akersryggen, Egebergløkka, Telthusbakken"
                },
                "25": {
                    "value": [
                        "GRØNTOMRÅDER ",
                        "BYER"
                    ]
                },
                "55": {
                    "value": "2016-03-16"
                },
                "80": {
                    "value": [
                        "Buskoven, Lene"
                    ]
                },
                "90": {
                    "value": "Oslo"
                },
                "95": {
                    "value": "Oslo"
                },
                "101": {
                    "value": "Norway"
                },
                "115": {
                    "value": "Riksantikvaren"
                },
                "116": {
                    "value": "Lene Buskoven"
                },
                "120": {
                    "value": "Kjærlighetsstien"
                },
                "200": {
                    "value": "700 Digitale bilder"
                },
                "208": {
                    "value": "URN:NBN:no-RAKV_arkiv_174373A47FCD40B1 A629D2BC548E6FD0"
                },
                "212": {
                    "value": "K124\n166922"
                },
                "315": {
                    "value": "Navngivelse (by): Dette verket er lisensiert under en Creative Commons Navngivelse 4.0 Internasjonal lisens"
                },
                "320": {
                    "value": "0"
                },
                "741": {
                    "value": "http://creativecommons.org/licenses/by/4.0/deed.no"
                }
            },
            "thumbnailFields": {
                "label": {
                    "value": "Akersryggen, Egebergløkka, Telthusbakken"
                },
                "firstLine": {
                    "value": "K124\n166922"
                },
                "secondLine": {
                    "value": "Oslo"
                },
                "additionalFields": [
                    {
                        "value": "Oslo",
                        "views": [
                            "desktop",
                            "widgets",
                            "web",
                            "pro"
                        ]
                    },
                    {
                        "value": [
                            "Buskoven, Lene"
                        ],
                        "views": [
                            "desktop",
                            "widgets",
                            "web",
                            "pro"
                        ]
                    },
                    {
                        "value": "Navngivelse (by): Dette verket er lisensiert under en Creative Commons Navngivelse 4.0 Internasjonal lisens",
                        "views": [
                            "desktop",
                            "widgets",
                            "web",
                            "pro"
                        ]
                    }
                ]
            },
            "builtinFields": [
                {
                    "field": "title",
                    "required": false,
                    "value": "Akersryggen, Egebergløkka, Telthusbakken"
                },
                {
                    "field": "description",
                    "required": false,
                    "value": "Kjærlighetsstien"
                },
                {
                    "field": "tags",
                    "required": false,
                    "value": [
                        "GRØNTOMRÅDER ",
                        "BYER"
                    ]
                },
                {
                    "field": "status",
                    "required": false,
                    "value": ""
                },
                {
                    "field": "notes",
                    "required": false,
                    "value": ""
                }
            ],
            "props": {
                "owner": null,
                "shares": {
                    "enabled": false
                },
                "comments": {
                    "enabled": false
                },
                "facebookComments": null,
                "annotations": {
                    "enabled": false
                },
                "tags": []
            }
        }
    ],
    "paging": null
};

    var API_URL = 'http://kart.ra.no/arcgis/rest/services/Distribusjon/Kulturminner/MapServer/'
    var IMAGE_API_BASE = 'http://kulturminnebilder.ra.no';


    var baseAPI = KR.ArcgisAPI(
        'kulturminne',
        {
            url: API_URL,
            idProp: 'ObjectID'
        }
    );


    var types = {
        enkeltminner: {
            layer: 4, 
            photoId: 'KulturminneID'
        },
        lokaliteter: {
            layer: 5,
            photoId: 'LokalitetID',
            subLayerId: 'LokalitetID',
            subLayerFunc: _getEnkeltminner
        },
        kulturmiljoer: {
            layer: 7,
            photoId: 'KulturmiljoID'
        }
    };
    
    function _getDataset(dataset, errorCallback) {

        if (! _.has(types, dataset.dataset)) {
            KR.Util.handleError(errorCallback, 'Unknown dataset ' + dataset.dataset);
        }
        return _.extend({}, dataset, types[dataset.dataset]);
    }

    function _parseEnkeltminer(response) {
        return response;
    }

    function _getEnkeltminner(key, id, callback, errorCallback) {
        var layer = types.enkeltminner.layer;
        var query = key + ' IN (' + id + ')';
        baseAPI.getSubLayer(query, layer, _parseEnkeltminer, true, function (response) {
            baseAPI.parseArcGisResponse(response, callback, errorCallback);
        }, errorCallback)
    }


    function getBbox(dataset, bbox, callback, errorCallback) {
        var parsedDataset = _getDataset(dataset);
        if (!parsedDataset) {
            return;
        }
        baseAPI.getBbox(parsedDataset, bbox, callback, errorCallback)
    }

    function _parseItem(data, callback) {
        return {
            media: _.map(data.data, function (data) {
                var image = _.findWhere(data.previews, {size: 400})
                return {
                    type: 'fotoweb_image',
                    href: IMAGE_API_BASE + data.href,
                    creator: _.has(data.metadata, '116') ? data.metadata['116'].value : null,
                    license: _.has(data.metadata, '315') ? data.metadata['315'].value : null,
                    image: IMAGE_API_BASE + image.href
                };
            })
        };


        //lenke: href

        //metadata
            //opphavsperson: 116
            //lisens: 315

        /*
        •   navn- tittel på det objektet som vises
        •   selve mediefila – bilde, video eller lydfil
        •   beskrivelse
        •   opphavsperson / rettighetshaver
        •   lisens
        •   lenke til original publisering
        */

        //bilde
        //previews where size == 600

    }

    function getItem(dataset, callback, errorCallback) {
        var parsedDataset = _getDataset(dataset);
        if (!parsedDataset) {
            return;
        }
        var id = dataset.feature.properties[parsedDataset.photoId]

        var data = _parseItem(mockData, callback);

        callback(data);

        /*
        var url = IMAGE_API_BASE + '/fotoweb/archives/5001-Alle%20kulturminnebilder/?212=' + id;
        return KR.Util.sendRequest(
            url,
            _parseItem,
            callback,
            errorCallback,
            {'Accept': 'application/vnd.fotoware.assetlist+json'}
        );
        */
    }

    function getSublayer(dataset, callback, errorCallback) {
        var parsedDataset = _getDataset(dataset);
        if (!parsedDataset) {
            return;
        }
        if (!_.has(parsedDataset, 'subLayerFunc')) {
            KR.Util.handleError(errorCallback, 'No subLayerFunc ' + dataset.dataset);
            return;
        }
        var key = parsedDataset.subLayerId;
        var func = parsedDataset.subLayerFunc;
        var id = dataset.feature.properties[key];

        func(key, id, callback, errorCallback);
    }

    return {
        getItem: getItem,
        getSublayer: getSublayer,
        getBbox: getBbox
    };
};
